var co = require('co');
var db = require(process.cwd()+'/libs/db');

db.connect(function() {

    var todo = db.get().collection("todo");
    var running = db.get().collection("running");
    var solvers = db.get().collection("solvers");
    var benchmarks = db.get().collection("benchmarks");

    co(function *(){

        // Delete everything
        yield [
            todo.remove({}),
            running.remove({}),
            solvers.remove({}),
            benchmarks.remove({})
        ];

        // Insert everything
        yield [
            solvers.insertOne({
                _id: 0,
                name: "test",
                container: "ubuntu:latest"
            }),
            benchmarks.insertOne({
                _id: 0,
                name: "test",
                index: 0,
                data: {
                    sleep_time: 10
                },
                timeout: 12
            }),
            todo.insertOne({
                solver_id: 0,
                benchmark_id: 0
            });
        ];

    }).catch(console.log);

    db.close();
});
